have to be very careful when using types here. typpescript assumes this is a browser environment, and I haven't figured out how to disable that.

need custom types for

- AbortController?

- fix the todo/typecheck failure in preview.ts (search for ts-expect-error)
